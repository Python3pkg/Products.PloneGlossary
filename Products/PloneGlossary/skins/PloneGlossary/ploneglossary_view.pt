<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ploneglossary">
  <head>
    <metal:cssslot fill-slot="css_slot">
      <style type="text/css" 
             media="all" 
             tal:condition="exists: portal/ploneglossary.css"
             tal:content="structure string:@import url($portal_url/ploneglossary.css);">
      </style>
    </metal:cssslot>
  </head>
  <body>
    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main">
        <div id="glossary"
             tal:define="gtool nocall:here/portal_glossary;
                         uid here/UID;
                         search_letter request/search_letter | nothing;
                         search_text request/search_text | nothing;">
          <h1 tal:content="here/title_or_id" 
              class="documentFirstHeading">
            Title or id
          </h1>
      
          <div metal:use-macro="here/document_actions/macros/document_actions">
              Document actions (print, sendto etc)
          </div>
      
          <div class="documentDescription"
             tal:content="here/Description">
            Description
          </div>

          
          <ul class="glossaryAbcedaire"
              tal:define="ascii_letters gtool/getAsciiLetters;
                          letters python:gtool.getAbcedaire([uid])">
            <li tal:repeat="letter ascii_letters">
              <a href="#"
                 tal:omit-tag="python:letter not in letters"
                 tal:attributes="href string:${here_url}?search_letter=${letter};
                                 class python:test(letter==search_letter, 'selected', None)"
                 tal:content="python: letter.upper()" /></li>
          </ul>
          
          <form name="glossary_search"
                action="search"
                tal:attributes="action string:${here_url}" >
            <label for="search_text" 
                   class="hiddenStructure" 
                   i18n:translate="label_text_search">
              Search
            </label>
            <input id="search_text"
                   name="search_text"
                   type="text"
                   size="20"
                   value=""
                   alt="Search"
                   title="Search"
                   i18n:attributes="alt title"
                   tal:attributes="value search_text;
                                   tabindex tabindex/next" />
                                   
            <input class="searchButton"
                   type="submit"
                   value="Search"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next" />
          </form>

          
          <tal:block tal:condition="search_letter">
            <tal:block tal:define="results python:gtool.getAbcedaireBrains([uid], letters=[search_letter])">
            
              <metal:macro define-macro="display_results">
                <tal:block tal:condition="results">
                  <tal:block tal:define="Batch python:modules['Products.CMFPlone'].Batch;
                                  b_size python:30;
                                  b_start request/b_start | python:0;
                                  batch python:Batch(results, b_size, int(b_start), orphan=1);">
                    <!-- Navigation -->
                    <div metal:use-macro="here/batch_macros/macros/navigation" />
                    <dl>
                     <tal:results repeat="result batch">
                      <tal:entry define="result_url result/getURL;
                                         url string:$result_url">
                        <dt>
                          <a href="#"
                             tal:attributes="href url">
                            <img src="#"
                                 height="16"
                                 width="16"
                                 alt=""
                                 tal:on-error="structure python:path('here/linkOpaque.gif')"
                                 tal:replace="structure here/ploneglossarydefinition_icon.gif" /></a>&nbsp;<a
                            href="#" tal:attributes="href url"
                            tal:content="python:result.Title or result.getId" />
                        </dt>
                          
                        <dd tal:define="description python:gtool.truncateDescription(result.Description);
                                        description python:description.replace('\n', '<br />');"
                            tal:content="structure description" />
              
                      </tal:entry>
                     </tal:results>
                    </dl>
                    <!-- Navigation -->
                    <div metal:use-macro="here/batch_macros/macros/navigation" />
                 </tal:block>
                </tal:block>
              </metal:macro>
            </tal:block>
          </tal:block>
          
          <tal:block tal:condition="search_text">
            <tal:block tal:define="results python:gtool.searchResults([uid], SearchableText=search_text);
                                   redirect_definition python:test(results and len(results) == 1, 1, 0)">
              <tal:block tal:condition="python:redirect_definition and results">
                <tal:block tal:define="url python:results[0].getURL();
                                       response request/RESPONSE;
                                       dummy python:response.redirect(url)" />
              </tal:block>
              <tal:block tal:condition="python:not redirect_definition and results">
                <metal:macro use-macro="template/macros/display_results" />
              </tal:block>
            </tal:block>
          </tal:block>
          
          
          <tal:block tal:condition="python:not search_text and not search_letter">
            <tal:block tal:define="results python:gtool.searchResults([uid], sort_on='Date', sort_order='reverse');">
              <tal:block tal:condition="results">
                <tal:block tal:define="results python:results[:3]">
                  <metal:macro use-macro="template/macros/display_results" />
                </tal:block>
              </tal:block>
            </tal:block>
          </tal:block>
          
          <div metal:use-macro="here/document_byline/macros/byline">
            Get the byline - contains details about author and modification date.
          </div>
        </div>
      </tal:main-macro>
    </metal:main>
  </body>
</html>
